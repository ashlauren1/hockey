from ratelimit import limits, sleep_and_retry
import requests
from bs4 import BeautifulSoup
import pandas as pd
from io import StringIO
import time
import os
from datetime import datetime

# Define rate limit parameters
REQUESTS_PER_MINUTE = 20
ONE_MINUTE = 60

@sleep_and_retry
@limits(calls=REQUESTS_PER_MINUTE, period=ONE_MINUTE)
def fetch_webpage(url):
    response = requests.get(url)
    response.raise_for_status()
    return response.text

def convert_toi_to_decimal(toi_str):
    """Convert TOI from 'mm:ss' to decimal minutes."""
    try:
        minutes, seconds = map(int, toi_str.split(':'))
        return minutes + seconds / 60
    except ValueError:
        return None

def extract_date_from_game_id(game_id):
    date_str = game_id[:8]
    return datetime.strptime(date_str, "%Y%m%d").strftime("%m/%d/%Y")

# Define the game IDs, home teams, and away teams
games_info = {
    "202210070NSH": ("NSH", "SJS"),
    "202210080SJS": ("SJS", "NSH"),
    "202210110LAK": ("LAK", "VEG"),
    "202210110NYR": ("NYR", "TBL"),
    "202210120ANA": ("ANA", "SEA"),
    "202210120CAR": ("CAR", "CBJ"),
    "202210120COL": ("COL", "CHI"),
    "202210120EDM": ("EDM", "VAN"),
    "202210120MTL": ("MTL", "TOR"),
    "202210120WSH": ("WSH", "BOS"),
    "202210130BUF": ("BUF", "OTT"),
    "202210130CGY": ("CGY", "COL"),
    "202210130LAK": ("LAK", "SEA"),
    "202210130MIN": ("MIN", "NYR"),
    "202210130NSH": ("NSH", "DAL"),
    "202210130NYI": ("NYI", "FLA"),
    "202210130PHI": ("PHI", "NJD"),
    "202210130PIT": ("PIT", "ARI"),
    "202210130TOR": ("TOR", "WSH"),
    "202210130VEG": ("VEG", "CHI"),
    "202210140CBJ": ("CBJ", "TBL"),
    "202210140DET": ("DET", "MTL"),
    "202210140SJS": ("SJS", "CAR"),
    "202210140WPG": ("WPG", "NYR"),
    "202210150BOS": ("BOS", "ARI"),
    "202210150BUF": ("BUF", "FLA"),
    "202210150DAL": ("DAL", "NSH"),
    "202210150EDM": ("EDM", "CGY"),
    "202210150MIN": ("MIN", "LAK"),
    "202210150NJD": ("NJD", "DET"),
    "202210150NYI": ("NYI", "ANA"),
    "202210150PHI": ("PHI", "VAN"),
    "202210150PIT": ("PIT", "TBL"),
    "202210150SEA": ("SEA", "VEG"),
    "202210150SJS": ("SJS", "CHI"),
    "202210150STL": ("STL", "CBJ"),
    "202210150TOR": ("TOR", "OTT"),
    "202210150WSH": ("WSH", "MTL"),
    "202210170BOS": ("BOS", "FLA"),
    "202210170DAL": ("DAL", "WPG"),
    "202210170DET": ("DET", "LAK"),
    "202210170MIN": ("MIN", "COL"),
    "202210170MTL": ("MTL", "PIT"),
    "202210170NYR": ("NYR", "ANA"),
    "202210170SEA": ("SEA", "CAR"),
    "202210170TOR": ("TOR", "ARI"),
    "202210170WSH": ("WSH", "VAN"),
    "202210180CBJ": ("CBJ", "VAN"),
    "202210180CGY": ("CGY", "VEG"),
    "202210180EDM": ("EDM", "BUF"),
    "202210180NJD": ("NJD", "ANA"),
    "202210180NSH": ("NSH", "LAK"),
    "202210180NYI": ("NYI", "SJS"),
    "202210180OTT": ("OTT", "BOS"),
    "202210180TBL": ("TBL", "PHI"),
    "202210190COL": ("COL", "WPG"),
    "202210190FLA": ("FLA", "PHI"),
    "202210190SEA": ("SEA", "STL"),
    "202210200BOS": ("BOS", "ANA"),
    "202210200CBJ": ("CBJ", "NSH"),
    "202210200CGY": ("CGY", "BUF"),
    "202210200EDM": ("EDM", "CAR"),
    "202210200MIN": ("MIN", "VAN"),
    "202210200MTL": ("MTL", "ARI"),
    "202210200NYI": ("NYI", "NJD"),
    "202210200NYR": ("NYR", "SJS"),
    "202210200OTT": ("OTT", "WSH"),
    "202210200PIT": ("PIT", "LAK"),
    "202210200TOR": ("TOR", "DAL"),
    "202210200VEG": ("VEG", "WPG"),
    "202210210CHI": ("CHI", "DET"),
    "202210210COL": ("COL", "SEA"),
    "202210210FLA": ("FLA", "TBL"),
    "202210220BOS": ("BOS", "MIN"),
    "202210220CBJ": ("CBJ", "PIT"),
    "202210220CGY": ("CGY", "CAR"),
    "202210220EDM": ("EDM", "STL"),
    "202210220MTL": ("MTL", "DAL"),
    "202210220NJD": ("NJD", "SJS"),
    "202210220NSH": ("NSH", "PHI"),
    "202210220OTT": ("OTT", "ARI"),
    "202210220TBL": ("TBL", "NYI"),
    "202210220VAN": ("VAN", "BUF"),
    "202210220VEG": ("VEG", "COL"),
    "202210220WPG": ("WPG", "TOR"),
    "202210220WSH": ("WSH", "LAK"),
    "202210230CHI": ("CHI", "SEA"),
    "202210230DET": ("DET", "ANA"),
    "202210230FLA": ("FLA", "NYI"),
    "202210230NYR": ("NYR", "CBJ"),
    "202210230PHI": ("PHI", "SJS"),
    "202210240EDM": ("EDM", "PIT"),
    "202210240NJD": ("NJD", "WSH"),
    "202210240OTT": ("OTT", "DAL"),
    "202210240VAN": ("VAN", "CAR"),
    "202210240VEG": ("VEG", "TOR"),
    "202210240WPG": ("WPG", "STL"),
    "202210250BOS": ("BOS", "DAL"),
    "202210250CBJ": ("CBJ", "ARI"),
    "202210250CGY": ("CGY", "PIT"),
    "202210250CHI": ("CHI", "FLA"),
    "202210250DET": ("DET", "NJD"),
    "202210250LAK": ("LAK", "TBL"),
    "202210250MTL": ("MTL", "MIN"),
    "202210250NYR": ("NYR", "COL"),
    "202210250SEA": ("SEA", "BUF"),
    "202210250SJS": ("SJS", "VEG"),
    "202210260ANA": ("ANA", "TBL"),
    "202210260NYI": ("NYI", "NYR"),
    "202210260STL": ("STL", "EDM"),
    "202210270BOS": ("BOS", "DET"),
    "202210270BUF": ("BUF", "MTL"),
    "202210270CHI": ("CHI", "EDM"),
    "202210270DAL": ("DAL", "WSH"),
    "202210270LAK": ("LAK", "WPG"),
    "202210270NSH": ("NSH", "STL"),
    "202210270OTT": ("OTT", "MIN"),
    "202210270PHI": ("PHI", "FLA"),
    "202210270SEA": ("SEA", "VAN"),
    "202210270SJS": ("SJS", "TOR"),
    "202210280ARI": ("ARI", "WPG"),
    "202210280CAR": ("CAR", "NYI"),
    "202210280CBJ": ("CBJ", "BOS"),
    "202210280NJD": ("NJD", "COL"),
    "202210280VAN": ("VAN", "PIT"),
    "202210280VEG": ("VEG", "ANA"),
    "202210290BUF": ("BUF", "CHI"),
    "202210290CGY": ("CGY", "EDM"),
    "202210290DAL": ("DAL", "NYR"),
    "202210290DET": ("DET", "MIN"),
    "202210290FLA": ("FLA", "OTT"),
    "202210290LAK": ("LAK", "TOR"),
    "202210290NSH": ("NSH", "WSH"),
    "202210290NYI": ("NYI", "COL"),
    "202210290PHI": ("PHI", "CAR"),
    "202210290SEA": ("SEA", "PIT"),
    "202210290SJS": ("SJS", "TBL"),
    "202210290STL": ("STL", "MTL"),
    "202210300ANA": ("ANA", "TOR"),
    "202210300ARI": ("ARI", "NYR"),
    "202210300CHI": ("CHI", "MIN"),
    "202210300NJD": ("NJD", "CBJ"),
    "202210300VEG": ("VEG", "WPG"),
    "202210310BUF": ("BUF", "DET"),
    "202210310CAR": ("CAR", "WSH"),
    "202210310STL": ("STL", "LAK"),
    "202211010ARI": ("ARI", "FLA"),
    "202211010CGY": ("CGY", "SEA"),
    "202211010CHI": ("CHI", "NYI"),
    "202211010DAL": ("DAL", "LAK"),
    "202211010EDM": ("EDM", "NSH"),
    "202211010MIN": ("MIN", "MTL"),
    "202211010NYR": ("NYR", "PHI"),
    "202211010PIT": ("PIT", "BOS"),
    "202211010SJS": ("SJS", "ANA"),
    "202211010TBL": ("TBL", "OTT"),
    "202211010VAN": ("VAN", "NJD"),
    "202211010WSH": ("WSH", "VEG"),
    "202211020BUF": ("BUF", "PIT"),
    "202211020TOR": ("TOR", "PHI"),
    "202211030ARI": ("ARI", "DAL"),
    "202211030CGY": ("CGY", "NSH"),
    "202211030CHI": ("CHI", "LAK"),
    "202211030DET": ("DET", "WSH"),
    "202211030EDM": ("EDM", "NJD"),
    "202211030MIN": ("MIN", "SEA"),
    "202211030NYR": ("NYR", "BOS"),
    "202211030OTT": ("OTT", "VEG"),
    "202211030SJS": ("SJS", "FLA"),
    "202211030STL": ("STL", "NYI"),
    "202211030TBL": ("TBL", "CAR"),
    "202211030VAN": ("VAN", "ANA"),
    "202211030WPG": ("WPG", "MTL"),
    "202211040CAR": ("CAR", "BUF"),
    "202211040COL": ("COL", "CBJ"),
    "202211050CBJ": ("CBJ", "COL"),
    "202211050CGY": ("CGY", "NJD"),
    "202211050DET": ("DET", "NYI"),
    "202211050EDM": ("EDM", "DAL"),
    "202211050LAK": ("LAK", "FLA"),
    "202211050MTL": ("MTL", "VEG"),
    "202211050OTT": ("OTT", "PHI"),
    "202211050PIT": ("PIT", "SEA"),
    "202211050SJS": ("SJS", "ANA"),
    "202211050TBL": ("TBL", "BUF"),
    "202211050TOR": ("TOR", "BOS"),
    "202211050VAN": ("VAN", "NSH"),
    "202211050WPG": ("WPG", "CHI"),
    "202211050WSH": ("WSH", "ARI"),
    "202211060ANA": ("ANA", "FLA"),
    "202211060CAR": ("CAR", "TOR"),
    "202211060NYR": ("NYR", "DET"),
    "202211070BOS": ("BOS", "STL"),
    "202211070NYI": ("NYI", "CGY"),
    "202211070WSH": ("WSH", "EDM"),
    "202211080BUF": ("BUF", "ARI"),
    "202211080DET": ("DET", "MTL"),
    "202211080LAK": ("LAK", "MIN"),
    "202211080NJD": ("NJD", "CGY"),
    "202211080NYR": ("NYR", "NYI"),
    "202211080OTT": ("OTT", "VAN"),
    "202211080PHI": ("PHI", "STL"),
    "202211080SEA": ("SEA", "NSH"),
    "202211080TBL": ("TBL", "EDM"),
    "202211080TOR": ("TOR", "VEG"),
    "202211080WPG": ("WPG", "DAL"),
    "202211090ANA": ("ANA", "MIN"),
    "202211090FLA": ("FLA", "CAR"),
    "202211090MTL": ("MTL", "VAN"),
    "202211090WSH": ("WSH", "PIT"),
    "202211100BOS": ("BOS", "CGY"),
    "202211100BUF": ("BUF", "VEG"),
    "202211100CAR": ("CAR", "EDM"),
    "202211100CBJ": ("CBJ", "PHI"),
    "202211100COL": ("COL", "NSH"),
    "202211100DET": ("DET", "NYR"),
    "202211100LAK": ("LAK", "CHI"),
    "202211100NJD": ("NJD", "OTT"),
    "202211100NYI": ("NYI", "ARI"),
    "202211100STL": ("STL", "SJS"),
    "202211110DAL": ("DAL", "SJS"),
    "202211110SEA": ("SEA", "MIN"),
    "202211110TOR": ("TOR", "PIT"),
    "202211110WSH": ("WSH", "TBL"),
    "202211120ANA": ("ANA", "CHI"),
    "202211120BUF": ("BUF", "BOS"),
    "202211120CGY": ("CGY", "WPG"),
    "202211120COL": ("COL", "CAR"),
    "202211120FLA": ("FLA", "EDM"),
    "202211120LAK": ("LAK", "DET"),
    "202211120MTL": ("MTL", "PIT"),
    "202211120NJD": ("NJD", "ARI"),
    "202211120NSH": ("NSH", "NYR"),
    "202211120NYI": ("NYI", "CBJ"),
    "202211120PHI": ("PHI", "OTT"),
    "202211120TOR": ("TOR", "VAN"),
    "202211120VEG": ("VEG", "STL"),
    "202211130BOS": ("BOS", "VAN"),
    "202211130MIN": ("MIN", "SJS"),
    "202211130NYR": ("NYR", "ARI"),
    "202211130PHI": ("PHI", "DAL"),
    "202211130SEA": ("SEA", "WPG"),
    "202211130TBL": ("TBL", "WSH"),
    "202211140CGY": ("CGY", "LAK"),
    "202211140CHI": ("CHI", "CAR"),
    "202211140COL": ("COL", "STL"),
    "202211140OTT": ("OTT", "NYI"),
    "202211150ANA": ("ANA", "DET"),
    "202211150BUF": ("BUF", "VAN"),
    "202211150CBJ": ("CBJ", "PHI"),
    "202211150FLA": ("FLA", "WSH"),
    "202211150MTL": ("MTL", "NJD"),
    "202211150NSH": ("NSH", "MIN"),
    "202211150PIT": ("PIT", "TOR"),
    "202211150TBL": ("TBL", "DAL"),
    "202211150VEG": ("VEG", "SJS"),
    "202211160CHI": ("CHI", "STL"),
    "202211160EDM": ("EDM", "LAK"),
    "202211160OTT": ("OTT", "BUF"),
    "202211170BOS": ("BOS", "PHI"),
    "202211170CAR": ("CAR", "COL"),
    "202211170CBJ": ("CBJ", "MTL"),
    "202211170FLA": ("FLA", "DAL"),
    "202211170MIN": ("MIN", "PIT"),
    "202211170NSH": ("NSH", "NYI"),
    "202211170SEA": ("SEA", "NYR"),
    "202211170SJS": ("SJS", "DET"),
    "202211170STL": ("STL", "WSH"),
    "202211170TBL": ("TBL", "CGY"),
    "202211170TOR": ("TOR", "NJD"),
    "202211170VEG": ("VEG", "ARI"),
    "202211170WPG": ("WPG", "ANA"),
    "202211180VAN": ("VAN", "LAK"),
    "202211190BOS": ("BOS", "CHI"),
    "202211190CBJ": ("CBJ", "DET"),
    "202211190DAL": ("DAL", "NYI"),
    "202211190EDM": ("EDM", "VEG"),
    "202211190FLA": ("FLA", "CGY"),
    "202211190MIN": ("MIN", "CAR"),
    "202211190MTL": ("MTL", "PHI"),
    "202211190NSH": ("NSH", "TBL"),
    "202211190OTT": ("OTT", "NJD"),
    "202211190SEA": ("SEA", "LAK"),
    "202211190SJS": ("SJS", "NYR"),
    "202211190STL": ("STL", "ANA"),
    "202211190TOR": ("TOR", "BUF"),
    "202211190WPG": ("WPG", "PIT"),
    "202211190WSH": ("WSH", "COL"),
    "202211200CBJ": ("CBJ", "FLA"),
    "202211200CHI": ("CHI", "PIT"),
    "202211210DAL": ("DAL", "COL"),
    "202211210NJD": ("NJD", "EDM"),
    "202211210NSH": ("NSH", "ARI"),
    "202211210PHI": ("PHI", "CGY"),
    "202211210SJS": ("SJS", "OTT"),
    "202211210STL": ("STL", "ANA"),
    "202211210TBL": ("TBL", "BOS"),
    "202211210TOR": ("TOR", "NYI"),
    "202211210VAN": ("VAN", "VEG"),
    "202211210WPG": ("WPG", "CAR"),
    "202211220LAK": ("LAK", "NYR"),
    "202211220MTL": ("MTL", "BUF"),
    "202211230ANA": ("ANA", "NYR"),
    "202211230BUF": ("BUF", "STL"),
    "202211230CAR": ("CAR", "ARI"),
    "202211230CBJ": ("CBJ", "MTL"),
    "202211230COL": ("COL", "VAN"),
    "202211230DAL": ("DAL", "CHI"),
    "202211230DET": ("DET", "NSH"),
    "202211230FLA": ("FLA", "BOS"),
    "202211230MIN": ("MIN", "WPG"),
    "202211230NJD": ("NJD", "TOR"),
    "202211230NYI": ("NYI", "EDM"),
    "202211230PIT": ("PIT", "CGY"),
    "202211230SEA": ("SEA", "SJS"),
    "202211230VEG": ("VEG", "OTT"),
    "202211230WSH": ("WSH", "PHI"),
    "202211250ANA": ("ANA", "OTT"),
    "202211250BOS": ("BOS", "CAR"),
    "202211250BUF": ("BUF", "NJD"),
    "202211250CBJ": ("CBJ", "NYI"),
    "202211250CHI": ("CHI", "MTL"),
    "202211250DAL": ("DAL", "WPG"),
    "202211250DET": ("DET", "ARI"),
    "202211250MIN": ("MIN", "TOR"),
    "202211250PHI": ("PHI", "PIT"),
    "202211250SJS": ("SJS", "LAK"),
    "202211250TBL": ("TBL", "STL"),
    "202211250VEG": ("VEG", "SEA"),
    "202211250WSH": ("WSH", "CGY"),
    "202211260CAR": ("CAR", "CGY"),
    "202211260COL": ("COL", "DAL"),
    "202211260FLA": ("FLA", "STL"),
    "202211260NJD": ("NJD", "WSH"),
    "202211260NYI": ("NYI", "PHI"),
    "202211260NYR": ("NYR", "EDM"),
    "202211260PIT": ("PIT", "TOR"),
    "202211260VEG": ("VEG", "VAN"),
    "202211270ANA": ("ANA", "SEA"),
    "202211270CHI": ("CHI", "WPG"),
    "202211270LAK": ("LAK", "OTT"),
    "202211270MIN": ("MIN", "ARI"),
    "202211270SJS": ("SJS", "VAN"),
    "202211280BUF": ("BUF", "TBL"),
    "202211280CBJ": ("CBJ", "VEG"),
    "202211280DET": ("DET", "TOR"),
    "202211280EDM": ("EDM", "FLA"),
    "202211280NYR": ("NYR", "NJD"),
    "202211280STL": ("STL", "DAL"),
    "202211290BOS": ("BOS", "TBL"),
    "202211290CGY": ("CGY", "FLA"),
    "202211290LAK": ("LAK", "SEA"),
    "202211290MTL": ("MTL", "SJS"),
    "202211290NSH": ("NSH", "ANA"),
    "202211290PHI": ("PHI", "NYI"),
    "202211290PIT": ("PIT", "CAR"),
    "202211290VAN": ("VAN", "WSH"),
    "202211290WPG": ("WPG", "COL"),
    "202211300CHI": ("CHI", "EDM"),
    "202211300DET": ("DET", "BUF"),
    "202211300OTT": ("OTT", "NYR"),
    "202211300TOR": ("TOR", "SJS"),
    "202212010BUF": ("BUF", "COL"),
    "202212010CGY": ("CGY", "MTL"),
    "202212010DAL": ("DAL", "ANA"),
    "202212010LAK": ("LAK", "ARI"),
    "202212010MIN": ("MIN", "EDM"),
    "202212010NJD": ("NJD", "NSH"),
    "202212010PHI": ("PHI", "TBL"),
    "202212010PIT": ("PIT", "VEG"),
    "202212010SEA": ("SEA", "WSH"),
    "202212010STL": ("STL", "CAR"),
    "202212010VAN": ("VAN", "FLA"),
    "202212020NYI": ("NYI", "NSH"),
    "202212020NYR": ("NYR", "OTT"),
    "202212020WPG": ("WPG", "CBJ"),
    "202212030BOS": ("BOS", "COL"),
    "202212030CGY": ("CGY", "WSH"),
    "202212030DET": ("DET", "VEG"),
    "202212030EDM": ("EDM", "MTL"),
    "202212030LAK": ("LAK", "CAR"),
    "202212030MIN": ("MIN", "ANA"),
    "202212030NYR": ("NYR", "CHI"),
    "202212030OTT": ("OTT", "SJS"),
    "202212030PHI": ("PHI", "NJD"),
    "202212030PIT": ("PIT", "STL"),
    "202212030SEA": ("SEA", "FLA"),
    "202212030TBL": ("TBL", "TOR"),
    "202212030VAN": ("VAN", "ARI"),
    "202212040BUF": ("BUF", "SJS"),
    "202212040CBJ": ("CBJ", "DET"),
    "202212040DAL": ("DAL", "MIN"),
    "202212040NYI": ("NYI", "CHI"),
    "202212040WPG": ("WPG", "ANA"),
    "202212050BOS": ("BOS", "VEG"),
    "202212050CGY": ("CGY", "ARI"),
    "202212050EDM": ("EDM", "WSH"),
    "202212050NYR": ("NYR", "STL"),
    "202212050PHI": ("PHI", "COL"),
    "202212050VAN": ("VAN", "MTL"),
    "202212060ANA": ("ANA", "CAR"),
    "202212060DAL": ("DAL", "TOR"),
    "202212060NJD": ("NJD", "CHI"),
    "202212060NYI": ("NYI", "STL"),
    "202212060OTT": ("OTT", "LAK"),
    "202212060PIT": ("PIT", "CBJ"),
    "202212060SEA": ("SEA", "MTL"),
    "202212060TBL": ("TBL", "DET"),
    "202212060WPG": ("WPG", "FLA"),
    "202212070CBJ": ("CBJ", "BUF"),
    "202212070CGY": ("CGY", "MIN"),
    "202212070COL": ("COL", "BOS"),
    "202212070EDM": ("EDM", "ARI"),
    "202212070PHI": ("PHI", "WSH"),
    "202212070SJS": ("SJS", "VAN"),
    "202212070VEG": ("VEG", "NYR"),
    "202212080DAL": ("DAL", "OTT"),
    "202212080FLA": ("FLA", "DET"),
    "202212080STL": ("STL", "WPG"),
    "202212080TBL": ("TBL", "NSH"),
    "202212080TOR": ("TOR", "LAK"),
    "202212090ANA": ("ANA", "SJS"),
    "202212090ARI": ("ARI", "BOS"),
    "202212090BUF": ("BUF", "PIT"),
    "202212090CBJ": ("CBJ", "CGY"),
    "202212090CHI": ("CHI", "WPG"),
    "202212090COL": ("COL", "NYR"),
    "202212090EDM": ("EDM", "MIN"),
    "202212090NJD": ("NJD", "NYI"),
    "202212090VEG": ("VEG", "PHI"),
    "202212090WSH": ("WSH", "SEA"),
    "202212100DAL": ("DAL", "DET"),
    "202212100MTL": ("MTL", "LAK"),
    "202212100NSH": ("NSH", "OTT"),
    "202212100NYI": ("NYI", "CAR"),
    "202212100PIT": ("PIT", "BUF"),
    "202212100TBL": ("TBL", "FLA"),
    "202212100TOR": ("TOR", "CGY"),
    "202212100VAN": ("VAN", "MIN"),
    "202212110ARI": ("ARI", "PHI"),
    "202212110CBJ": ("CBJ", "LAK"),
    "202212110FLA": ("FLA", "SEA"),
    "202212110STL": ("STL", "COL"),
    "202212110VEG": ("VEG", "BOS"),
    "202212110WPG": ("WPG", "WSH"),
    "202212120MIN": ("MIN", "EDM"),
    "202212120MTL": ("MTL", "CGY"),
    "202212120NYR": ("NYR", "NJD"),
    "202212120OTT": ("OTT", "ANA"),
    "202212120PIT": ("PIT", "DAL"),
    "202212120STL": ("STL", "NSH"),
    "202212130BOS": ("BOS", "NYI"),
    "202212130BUF": ("BUF", "LAK"),
    "202212130CHI": ("CHI", "WSH"),
    "202212130COL": ("COL", "PHI"),
    "202212130DET": ("DET", "CAR"),
    "202212130FLA": ("FLA", "CBJ"),
    "202212130NJD": ("NJD", "DAL"),
    "202212130NSH": ("NSH", "EDM"),
    "202212130SJS": ("SJS", "ARI"),
    "202212130TBL": ("TBL", "SEA"),
    "202212130TOR": ("TOR", "ANA"),
    "202212130WPG": ("WPG", "VEG"),
    "202212140CGY": ("CGY", "VAN"),
    "202212140MIN": ("MIN", "DET"),
    "202212140OTT": ("OTT", "MTL"),
    "202212150BOS": ("BOS", "LAK"),
    "202212150CAR": ("CAR", "SEA"),
    "202212150CHI": ("CHI", "VEG"),
    "202212150COL": ("COL", "BUF"),
    "202212150EDM": ("EDM", "STL"),
    "202212150FLA": ("FLA", "PIT"),
    "202212150MTL": ("MTL", "ANA"),
    "202212150NJD": ("NJD", "PHI"),
    "202212150NYR": ("NYR", "TOR"),
    "202212150TBL": ("TBL", "CBJ"),
    "202212150WPG": ("WPG", "NSH"),
    "202212150WSH": ("WSH", "DAL"),
    "202212160ARI": ("ARI", "NYI"),
    "202212160CGY": ("CGY", "STL"),
    "202212160MIN": ("MIN", "CHI"),
    "202212170ARI": ("ARI", "BUF"),
    "202212170BOS": ("BOS", "CBJ"),
    "202212170CAR": ("CAR", "DAL"),
    "202212170COL": ("COL", "NSH"),
    "202212170DET": ("DET", "OTT"),
    "202212170EDM": ("EDM", "ANA"),
    "202212170LAK": ("LAK", "SJS"),
    "202212170MTL": ("MTL", "TBL"),
    "202212170NJD": ("NJD", "FLA"),
    "202212170PHI": ("PHI", "NYR"),
    "202212170VAN": ("VAN", "WPG"),
    "202212170VEG": ("VEG", "NYI"),
    "202212170WSH": ("WSH", "TOR"),
    "202212180CAR": ("CAR", "PIT"),
    "202212180CHI": ("CHI", "NYR"),
    "202212180MIN": ("MIN", "OTT"),
    "202212180SEA": ("SEA", "WPG"),
    "202212180SJS": ("SJS", "CGY"),
    "202212190ARI": ("ARI", "MTL"),
    "202212190BOS": ("BOS", "FLA"),
    "202212190CBJ": ("CBJ", "DAL"),
    "202212190COL": ("COL", "NYI"),
    "202212190NSH": ("NSH", "EDM"),
    "202212190VAN": ("VAN", "STL"),
    "202212190VEG": ("VEG", "BUF"),
    "202212190WSH": ("WSH", "DET"),
    "202212200CAR": ("CAR", "NJD"),
    "202212200LAK": ("LAK", "ANA"),
    "202212200PHI": ("PHI", "CBJ"),
    "202212200PIT": ("PIT", "NYR"),
    "202212200SEA": ("SEA", "STL"),
    "202212200SJS": ("SJS", "CGY"),
    "202212200TOR": ("TOR", "TBL"),
    "202212200WPG": ("WPG", "OTT"),
    "202212210ANA": ("ANA", "MIN"),
    "202212210CHI": ("CHI", "NSH"),
    "202212210COL": ("COL", "MTL"),
    "202212210DAL": ("DAL", "EDM"),
    "202212210DET": ("DET", "TBL"),
    "202212210FLA": ("FLA", "NJD"),
    "202212210VEG": ("VEG", "ARI"),
    "202212220BOS": ("BOS", "WPG"),
    "202212220LAK": ("LAK", "CGY"),
    "202212220NYR": ("NYR", "NYI"),
    "202212220OTT": ("OTT", "WSH"),
    "202212220PIT": ("PIT", "CAR"),
    "202212220SJS": ("SJS", "MIN"),
    "202212220TOR": ("TOR", "PHI"),
    "202212220VAN": ("VAN", "SEA"),
    "202212230ANA": ("ANA", "CGY"),
    "202212230ARI": ("ARI", "LAK"),
    "202212230CAR": ("CAR", "PHI"),
    "202212230CHI": ("CHI", "CBJ"),
    "202212230DAL": ("DAL", "MTL"),
    "202212230EDM": ("EDM", "VAN"),
    "202212230NJD": ("NJD", "BOS"),
    "202212230NSH": ("NSH", "COL"),
    "202212230NYI": ("NYI", "FLA"),
    "202212230VEG": ("VEG", "STL"),
    "202212230WSH": ("WSH", "WPG"),
    "202212270ARI": ("ARI", "COL"),
    "202212270CAR": ("CAR", "CHI"),
    "202212270CGY": ("CGY", "EDM"),
    "202212270LAK": ("LAK", "VEG"),
    "202212270NSH": ("NSH", "DAL"),
    "202212270NYI": ("NYI", "PIT"),
    "202212270NYR": ("NYR", "WSH"),
    "202212270OTT": ("OTT", "BOS"),
    "202212270STL": ("STL", "TOR"),
    "202212270VAN": ("VAN", "SJS"),
    "202212270WPG": ("WPG", "MIN"),
    "202212280ANA": ("ANA", "VEG"),
    "202212280NJD": ("NJD", "BOS"),
    "202212280PIT": ("PIT", "DET"),
    "202212280SEA": ("SEA", "CGY"),
    "202212280TBL": ("TBL", "MTL"),
    "202212290ARI": ("ARI", "TOR"),
    "202212290BUF": ("BUF", "DET"),
    "202212290COL": ("COL", "LAK"),
    "202212290FLA": ("FLA", "MTL"),
    "202212290MIN": ("MIN", "DAL"),
    "202212290NYI": ("NYI", "CBJ"),
    "202212290SJS": ("SJS", "PHI"),
    "202212290STL": ("STL", "CHI"),
    "202212290TBL": ("TBL", "NYR"),
    "202212290WPG": ("WPG", "VAN"),
    "202212290WSH": ("WSH", "OTT"),
    "202212300ANA": ("ANA", "NSH"),
    "202212300CAR": ("CAR", "FLA"),
    "202212300PIT": ("PIT", "NJD"),
    "202212300SEA": ("SEA", "EDM"),
    "202212310BOS": ("BOS", "BUF"),
    "202212310CBJ": ("CBJ", "CHI"),
    "202212310CGY": ("CGY", "VAN"),
    "202212310COL": ("COL", "TOR"),
    "202212310DAL": ("DAL", "SJS"),
    "202212310DET": ("DET", "OTT"),
    "202212310EDM": ("EDM", "WPG"),
    "202212310LAK": ("LAK", "PHI"),
    "202212310STL": ("STL", "MIN"),
    "202212310TBL": ("TBL", "ARI"),
    "202212310VEG": ("VEG", "NSH"),
    "202212310WSH": ("WSH", "MTL"),
    "202301010CHI": ("CHI", "SJS"),
    "202301010FLA": ("FLA", "NYR"),
    "202301010NJD": ("NJD", "CAR"),
    "202301010OTT": ("OTT", "BUF"),
    "202301010SEA": ("SEA", "NYI"),
    "202301020ANA": ("ANA", "PHI"),
    "202301020BOS": ("BOS", "PIT"),
    "202301020COL": ("COL", "VEG"),
    "202301030CHI": ("CHI", "TBL"),
    "202301030EDM": ("EDM", "SEA"),
    "202301030FLA": ("FLA", "ARI"),
    "202301030LAK": ("LAK", "DAL"),
    "202301030NSH": ("NSH", "MTL"),
    "202301030NYR": ("NYR", "CAR"),
    "202301030OTT": ("OTT", "CBJ"),
    "202301030TOR": ("TOR", "STL"),
    "202301030VAN": ("VAN", "NYI"),
    "202301030WPG": ("WPG", "CGY"),
    "202301030WSH": ("WSH", "BUF"),
    "202301040ANA": ("ANA", "DAL"),
    "202301040DET": ("DET", "NJD"),
    "202301040MIN": ("MIN", "TBL"),
    "202301050CAR": ("CAR", "NSH"),
    "202301050CBJ": ("CBJ", "WSH"),
    "202301050EDM": ("EDM", "NYI"),
    "202301050LAK": ("LAK", "BOS"),
    "202301050MTL": ("MTL", "NYR"),
    "202301050NJD": ("NJD", "STL"),
    "202301050PHI": ("PHI", "ARI"),
    "202301050TOR": ("TOR", "SEA"),
    "202301050VAN": ("VAN", "COL"),
    "202301050VEG": ("VEG", "PIT"),
    "202301060ANA": ("ANA", "SJS"),
    "202301060CGY": ("CGY", "NYI"),
    "202301060CHI": ("CHI", "ARI"),
    "202301060DET": ("DET", "FLA"),
    "202301060WPG": ("WPG", "TBL"),
    "202301060WSH": ("WSH", "NSH"),
    "202301070BUF": ("BUF", "MIN"),
    "202301070CBJ": ("CBJ", "CAR"),
    "202301070EDM": ("EDM", "COL"),
    "202301070MTL": ("MTL", "STL"),
    "202301070NJD": ("NJD", "NYR"),
    "202301070OTT": ("OTT", "SEA"),
    "202301070SJS": ("SJS", "BOS"),
    "202301070TOR": ("TOR", "DET"),
    "202301070VEG": ("VEG", "LAK"),
    "202301080ANA": ("ANA", "BOS"),
    "202301080ARI": ("ARI", "PIT"),
    "202301080CHI": ("CHI", "CGY"),
    "202301080DAL": ("DAL", "FLA"),
    "202301080MIN": ("MIN", "STL"),
    "202301080PHI": ("PHI", "TOR"),
    "202301080WPG": ("WPG", "VAN"),
    "202301080WSH": ("WSH", "CBJ"),
    "202301090BUF": ("BUF", "PHI"),
    "202301090LAK": ("LAK", "EDM"),
    "202301090MTL": ("MTL", "SEA"),
    "202301090OTT": ("OTT", "NSH"),
    "202301100ARI": ("ARI", "SJS"),
    "202301100BUF": ("BUF", "SEA"),
    "202301100CAR": ("CAR", "NJD"),
    "202301100COL": ("COL", "FLA"),
    "202301100DET": ("DET", "WPG"),
    "202301100NYI": ("NYI", "DAL"),
    "202301100NYR": ("NYR", "MIN"),
    "202301100PIT": ("PIT", "VAN"),
    "202301100STL": ("STL", "CGY"),
    "202301100TBL": ("TBL", "CBJ"),
    "202301110ANA": ("ANA", "EDM"),
    "202301110LAK": ("LAK", "SJS"),
    "202301110PHI": ("PHI", "WSH"),
    "202301110TOR": ("TOR", "NSH"),
    "202301120ARI": ("ARI", "OTT"),
    "202301120BOS": ("BOS", "SEA"),
    "202301120BUF": ("BUF", "WPG"),
    "202301120CBJ": ("CBJ", "CAR"),
    "202301120CHI": ("CHI", "COL"),
    "202301120DET": ("DET", "TOR"),
    "202301120MTL": ("MTL", "NSH"),
    "202301120NYI": ("NYI", "MIN"),
    "202301120NYR": ("NYR", "DAL"),
    "202301120STL": ("STL", "CGY"),
    "202301120TBL": ("TBL", "VAN"),
    "202301120VEG": ("VEG", "FLA"),
    "202301130ANA": ("ANA", "NJD"),
    "202301130PIT": ("PIT", "WPG"),
    "202301130SJS": ("SJS", "EDM"),
    "202301140BOS": ("BOS", "TOR"),
    "202301140CAR": ("CAR", "PIT"),
    "202301140CHI": ("CHI", "SEA"),
    "202301140COL": ("COL", "OTT"),
    "202301140DAL": ("DAL", "CGY"),
    "202301140DET": ("DET", "CBJ"),
    "202301140FLA": ("FLA", "VAN"),
    "202301140LAK": ("LAK", "NJD"),
    "202301140MIN": ("MIN", "ARI"),
    "202301140NSH": ("NSH", "BUF"),
    "202301140NYI": ("NYI", "MTL"),
    "202301140STL": ("STL", "TBL"),
    "202301140VEG": ("VEG", "EDM"),
    "202301140WSH": ("WSH", "PHI"),
    "202301150CAR": ("CAR", "VAN"),
    "202301150NYR": ("NYR", "MTL"),
    "202301150WPG": ("WPG", "ARI"),
    "202301160BOS": ("BOS", "PHI"),
    "202301160BUF": ("BUF", "FLA"),
    "202301160CBJ": ("CBJ", "NYR"),
    "202301160COL": ("COL", "DET"),
    "202301160NSH": ("NSH", "CGY"),
    "202301160NYI": ("NYI", "WSH"),
    "202301160PIT": ("PIT", "ANA"),
    "202301160SEA": ("SEA", "TBL"),
    "202301160SJS": ("SJS", "NJD"),
    "202301160STL": ("STL", "OTT"),
    "202301160VEG": ("VEG", "DAL"),
    "202301170ARI": ("ARI", "DET"),
    "202301170CHI": ("CHI", "BUF"),
    "202301170EDM": ("EDM", "SEA"),
    "202301170MTL": ("MTL", "WPG"),
    "202301170NSH": ("NSH", "CBJ"),
    "202301170PHI": ("PHI", "ANA"),
    "202301170TOR": ("TOR", "FLA"),
    "202301170WSH": ("WSH", "MIN"),
    "202301180CGY": ("CGY", "COL"),
    "202301180NYI": ("NYI", "BOS"),
    "202301180OTT": ("OTT", "PIT"),
    "202301180SJS": ("SJS", "DAL"),
    "202301180VAN": ("VAN", "TBL"),
    "202301190ARI": ("ARI", "WSH"),
    "202301190BUF": ("BUF", "NYI"),
    "202301190CAR": ("CAR", "MIN"),
    "202301190CBJ": ("CBJ", "ANA"),
    "202301190EDM": ("EDM", "TBL"),
    "202301190LAK": ("LAK", "DAL"),
    "202301190MTL": ("MTL", "FLA"),
    "202301190NYR": ("NYR", "BOS"),
    "202301190PHI": ("PHI", "CHI"),
    "202301190SEA": ("SEA", "NJD"),
    "202301190STL": ("STL", "NSH"),
    "202301190TOR": ("TOR", "WPG"),
    "202301190VEG": ("VEG", "DET"),
    "202301200PIT": ("PIT", "OTT"),
    "202301200VAN": ("VAN", "COL"),
    "202301210BUF": ("BUF", "ANA"),
    "202301210CBJ": ("CBJ", "SJS"),
    "202301210CGY": ("CGY", "TBL"),
    "202301210DAL": ("DAL", "ARI"),
    "202301210DET": ("DET", "PHI"),
    "202301210FLA": ("FLA", "MIN"),
    "202301210MTL": ("MTL", "TOR"),
    "202301210NSH": ("NSH", "LAK"),
    "202301210NYI": ("NYI", "CAR"),
    "202301210OTT": ("OTT", "WPG"),
    "202301210SEA": ("SEA", "COL"),
    "202301210STL": ("STL", "CHI"),
    "202301210VAN": ("VAN", "EDM"),
    "202301210VEG": ("VEG", "WSH"),
    "202301220ARI": ("ARI", "VEG"),
    "202301220BOS": ("BOS", "SJS"),
    "202301220CHI": ("CHI", "LAK"),
    "202301220NJD": ("NJD", "PIT"),
    "202301220PHI": ("PHI", "WPG"),
    "202301230CGY": ("CGY", "CBJ"),
    "202301230DAL": ("DAL", "BUF"),
    "202301230NYR": ("NYR", "FLA"),
    "202301230TOR": ("TOR", "NYI"),
    "202301240ARI": ("ARI", "ANA"),
    "202301240COL": ("COL", "WSH"),
    "202301240DET": ("DET", "SJS"),
    "202301240MTL": ("MTL", "BOS"),
    "202301240NJD": ("NJD", "VEG"),
    "202301240NSH": ("NSH", "WPG"),
    "202301240PHI": ("PHI", "LAK"),
    "202301240PIT": ("PIT", "FLA"),
    "202301240STL": ("STL", "BUF"),
    "202301240TBL": ("TBL", "MIN"),
    "202301240VAN": ("VAN", "CHI"),
    "202301250DAL": ("DAL", "CAR"),
    "202301250EDM": ("EDM", "CBJ"),
    "202301250OTT": ("OTT", "NYI"),
    "202301250SEA": ("SEA", "VAN"),
    "202301250TOR": ("TOR", "NYR"),
    "202301260ARI": ("ARI", "STL"),
    "202301260CGY": ("CGY", "CHI"),
    "202301260COL": ("COL", "ANA"),
    "202301260MIN": ("MIN", "PHI"),
    "202301260MTL": ("MTL", "DET"),
    "202301260NSH": ("NSH", "NJD"),
    "202301260TBL": ("TBL", "BOS"),
    "202301260WPG": ("WPG", "BUF"),
    "202301260WSH": ("WSH", "PIT"),
    "202301270CAR": ("CAR", "SJS"),
    "202301270DAL": ("DAL", "NJD"),
    "202301270FLA": ("FLA", "LAK"),
    "202301270NYI": ("NYI", "DET"),
    "202301270NYR": ("NYR", "VEG"),
    "202301270SEA": ("SEA", "CGY"),
    "202301270TOR": ("TOR", "OTT"),
    "202301270VAN": ("VAN", "CBJ"),
    "202301280ANA": ("ANA", "ARI"),
    "202301280COL": ("COL", "STL"),
    "202301280EDM": ("EDM", "CHI"),
    "202301280FLA": ("FLA", "BOS"),
    "202301280MIN": ("MIN", "BUF"),
    "202301280NYI": ("NYI", "VEG"),
    "202301280OTT": ("OTT", "MTL"),
    "202301280PIT": ("PIT", "SJS"),
    "202301280SEA": ("SEA", "CBJ"),
    "202301280TBL": ("TBL", "LAK"),
    "202301280WPG": ("WPG", "PHI"),
    "202301290CAR": ("CAR", "BOS"),
    "202301290TOR": ("TOR", "WSH"),
    "202301300WPG": ("WPG", "STL"),
    "202301310CAR": ("CAR", "LAK"),
    "202301310CBJ": ("CBJ", "WSH"),
    "202301310MTL": ("MTL", "OTT"),
    "202302010BUF": ("BUF", "CAR"),
    "202302010TOR": ("TOR", "BOS"),
    "202302060ARI": ("ARI", "MIN"),
    "202302060DAL": ("DAL", "ANA"),
    "202302060FLA": ("FLA", "TBL"),
    "202302060NJD": ("NJD", "VAN"),
    "202302060NYR": ("NYR", "CGY"),
    "202302060PHI": ("PHI", "NYI"),
    "202302070CHI": ("CHI", "ANA"),
    "202302070DET": ("DET", "EDM"),
    "202302070NSH": ("NSH", "VEG"),
    "202302070NYI": ("NYI", "SEA"),
    "202302070PIT": ("PIT", "COL"),
    "202302070TBL": ("TBL", "SJS"),
    "202302080DAL": ("DAL", "MIN"),
    "202302080NYR": ("NYR", "VAN"),
    "202302090DET": ("DET", "CGY"),
    "202302090FLA": ("FLA", "SJS"),
    "202302090MIN": ("MIN", "VEG"),
    "202302090NJD": ("NJD", "SEA"),
    "202302090NYI": ("NYI", "VAN"),
    "202302090PHI": ("PHI", "EDM"),
    "202302090TBL": ("TBL", "COL"),
    "202302100ANA": ("ANA", "PIT"),
    "202302100CBJ": ("CBJ", "TOR"),
    "202302100CHI": ("CHI", "ARI"),
    "202302100NYR": ("NYR", "SEA"),
    "202302110BOS": ("BOS", "WSH"),
    "202302110BUF": ("BUF", "CGY"),
    "202302110CAR": ("CAR", "NYR"),
    "202302110DAL": ("DAL", "TBL"),
    "202302110DET": ("DET", "VAN"),
    "202302110FLA": ("FLA", "COL"),
    "202302110LAK": ("LAK", "PIT"),
    "202302110MIN": ("MIN", "NJD"),
    "202302110MTL": ("MTL", "NYI"),
    "202302110OTT": ("OTT", "EDM"),
    "202302110PHI": ("PHI", "NSH"),
    "202302110STL": ("STL", "ARI"),
    "202302110TOR": ("TOR", "CBJ"),
    "202302110WPG": ("WPG", "CHI"),
    "202302120MTL": ("MTL", "EDM"),
    "202302120PHI": ("PHI", "SEA"),
    "202302120VEG": ("VEG", "ANA"),
    "202302120WSH": ("WSH", "SJS"),
    "202302130LAK": ("LAK", "BUF"),
    "202302130MIN": ("MIN", "FLA"),
    "202302130NSH": ("NSH", "ARI"),
    "202302130OTT": ("OTT", "CGY"),
    "202302130VAN": ("VAN", "DET"),
    "202302140CBJ": ("CBJ", "NJD"),
    "202302140COL": ("COL", "TBL"),
    "202302140DAL": ("DAL", "BOS"),
    "202302140MTL": ("MTL", "CHI"),
    "202302140NYI": ("NYI", "OTT"),
    "202302140SJS": ("SJS", "PIT"),
    "202302140STL": ("STL", "FLA"),
    "202302140WPG": ("WPG", "SEA"),
    "202302140WSH": ("WSH", "CAR"),
    "202302150ANA": ("ANA", "BUF"),
    "202302150ARI": ("ARI", "TBL"),
    "202302150EDM": ("EDM", "DET"),
    "202302150MIN": ("MIN", "COL"),
    "202302150TOR": ("TOR", "CHI"),
    "202302150VAN": ("VAN", "NYR"),
    "202302160CAR": ("CAR", "MTL"),
    "202302160CBJ": ("CBJ", "WPG"),
    "202302160CGY": ("CGY", "DET"),
    "202302160NSH": ("NSH", "BOS"),
    "202302160SEA": ("SEA", "PHI"),
    "202302160STL": ("STL", "NJD"),
    "202302160VEG": ("VEG", "SJS"),
    "202302160WSH": ("WSH", "FLA"),
    "202302170ANA": ("ANA", "LAK"),
    "202302170EDM": ("EDM", "NYR"),
    "202302170MIN": ("MIN", "DAL"),
    "202302170NYI": ("NYI", "PIT"),
    "202302170OTT": ("OTT", "CHI"),
    "202302180BOS": ("BOS", "NYI"),
    "202302180CAR": ("CAR", "WSH"),
    "202302180CGY": ("CGY", "NYR"),
    "202302180DAL": ("DAL", "CBJ"),
    "202302180LAK": ("LAK", "ARI"),
    "202302180NSH": ("NSH", "FLA"),
    "202302180PIT": ("PIT", "NJD"),
    "202302180SEA": ("SEA", "DET"),
    "202302180SJS": ("SJS", "BUF"),
    "202302180STL": ("STL", "COL"),
    "202302180TOR": ("TOR", "MTL"),
    "202302180VAN": ("VAN", "PHI"),
    "202302180VEG": ("VEG", "TBL"),
    "202302190ARI": ("ARI", "CBJ"),
    "202302190CHI": ("CHI", "TOR"),
    "202302190COL": ("COL", "EDM"),
    "202302190MIN": ("MIN", "NSH"),
    "202302190NJD": ("NJD", "WPG"),
    "202302190OTT": ("OTT", "STL"),
    "202302200BOS": ("BOS", "OTT"),
    "202302200CGY": ("CGY", "PHI"),
    "202302200FLA": ("FLA", "ANA"),
    "202302200NYR": ("NYR", "WPG"),
    "202302200PIT": ("PIT", "NYI"),
    "202302200SJS": ("SJS", "SEA"),
    "202302210BUF": ("BUF", "TOR"),
    "202302210CAR": ("CAR", "STL"),
    "202302210CHI": ("CHI", "VEG"),
    "202302210EDM": ("EDM", "PHI"),
    "202302210MIN": ("MIN", "LAK"),
    "202302210NJD": ("NJD", "MTL"),
    "202302210NSH": ("NSH", "VAN"),
    "202302210TBL": ("TBL", "ANA"),
    "202302210WSH": ("WSH", "DET"),
    "202302220ARI": ("ARI", "CGY"),
    "202302220DAL": ("DAL", "CHI"),
    "202302220NYI": ("NYI", "WPG"),
    "202302230CBJ": ("CBJ", "MIN"),
    "202302230DET": ("DET", "NYR"),
    "202302230NJD": ("NJD", "LAK"),
    "202302230PIT": ("PIT", "EDM"),
    "202302230SEA": ("SEA", "BOS"),
    "202302230SJS": ("SJS", "NSH"),
    "202302230STL": ("STL", "VAN"),
    "202302230TBL": ("TBL", "BUF"),
    "202302230VEG": ("VEG", "CGY"),
    "202302230WSH": ("WSH", "ANA"),
    "202302240CAR": ("CAR", "OTT"),
    "202302240FLA": ("FLA", "BUF"),
    "202302240NYI": ("NYI", "LAK"),
    "202302240PHI": ("PHI", "MTL"),
    "202302240TOR": ("TOR", "MIN"),
    "202302240WPG": ("WPG", "COL"),
    "202302250CAR": ("CAR", "ANA"),
    "202302250CBJ": ("CBJ", "EDM"),
    "202302250COL": ("COL", "CGY"),
    "202302250DET": ("DET", "TBL"),
    "202302250MTL": ("MTL", "OTT"),
    "202302250NJD": ("NJD", "PHI"),
    "202302250SJS": ("SJS", "CHI"),
    "202302250STL": ("STL", "PIT"),
    "202302250VAN": ("VAN", "BOS"),
    "202302250VEG": ("VEG", "DAL"),
    "202302250WSH": ("WSH", "NYR"),
    "202302260ARI": ("ARI", "NSH"),
    "202302260BUF": ("BUF", "WSH"),
    "202302260MIN": ("MIN", "CBJ"),
    "202302260NYR": ("NYR", "LAK"),
    "202302260PIT": ("PIT", "TBL"),
    "202302260SEA": ("SEA", "TOR"),
    "202302260WPG": ("WPG", "NYI"),
    "202302270ANA": ("ANA", "CHI"),
    "202302270COL": ("COL", "VEG"),
    "202302270DAL": ("DAL", "VAN"),
    "202302270EDM": ("EDM", "BOS"),
    "202302270OTT": ("OTT", "DET"),
    "202302280ARI": ("ARI", "CHI"),
    "202302280BUF": ("BUF", "CBJ"),
    "202302280CGY": ("CGY", "BOS"),
    "202302280MIN": ("MIN", "NYI"),
    "202302280NSH": ("NSH", "PIT"),
    "202302280OTT": ("OTT", "DET"),
    "202302280SJS": ("SJS", "MTL"),
    "202302280STL": ("STL", "SEA"),
    "202302280TBL": ("TBL", "FLA"),
    "202302280WPG": ("WPG", "LAK"),
    "202303010ANA": ("ANA", "WSH"),
    "202303010COL": ("COL", "NJD"),
    "202303010DAL": ("DAL", "ARI"),
    "202303010EDM": ("EDM", "TOR"),
    "202303010PHI": ("PHI", "NYR"),
    "202303010VEG": ("VEG", "CAR"),
    "202303020BOS": ("BOS", "BUF"),
    "202303020CGY": ("CGY", "TOR"),
    "202303020CHI": ("CHI", "DAL"),
    "202303020DET": ("DET", "SEA"),
    "202303020FLA": ("FLA", "NSH"),
    "202303020LAK": ("LAK", "MTL"),
    "202303020NYR": ("NYR", "OTT"),
    "202303020SJS": ("SJS", "STL"),
    "202303020TBL": ("TBL", "PIT"),
    "202303020VAN": ("VAN", "MIN"),
    "202303030ANA": ("ANA", "MTL"),
    "202303030ARI": ("ARI", "CAR"),
    "202303030CBJ": ("CBJ", "SEA"),
    "202303030EDM": ("EDM", "WPG"),
    "202303030VEG": ("VEG", "NJD"),
    "202303040BOS": ("BOS", "NYR"),
    "202303040BUF": ("BUF", "TBL"),
    "202303040CGY": ("CGY", "MIN"),
    "202303040CHI": ("CHI", "NSH"),
    "202303040DAL": ("DAL", "COL"),
    "202303040FLA": ("FLA", "PIT"),
    "202303040LAK": ("LAK", "STL"),
    "202303040NYI": ("NYI", "DET"),
    "202303040OTT": ("OTT", "CBJ"),
    "202303040SJS": ("SJS", "WSH"),
    "202303040VAN": ("VAN", "TOR"),
    "202303040WPG": ("WPG", "EDM"),
    "202303050ARI": ("ARI", "NJD"),
    "202303050CAR": ("CAR", "TBL"),
    "202303050COL": ("COL", "SEA"),
    "202303050PHI": ("PHI", "DET"),
    "202303050VEG": ("VEG", "MTL"),
    "202303060BUF": ("BUF", "EDM"),
    "202303060CHI": ("CHI", "OTT"),
    "202303060DAL": ("DAL", "CGY"),
    "202303060LAK": ("LAK", "WSH"),
    "202303060VAN": ("VAN", "NSH"),
    "202303060WPG": ("WPG", "SJS"),
    "202303070ARI": ("ARI", "STL"),
    "202303070COL": ("COL", "SJS"),
    "202303070FLA": ("FLA", "VEG"),
    "202303070MIN": ("MIN", "CGY"),
    "202303070MTL": ("MTL", "CAR"),
    "202303070NJD": ("NJD", "TOR"),
    "202303070NYI": ("NYI", "BUF"),
    "202303070PIT": ("PIT", "CBJ"),
    "202303070SEA": ("SEA", "ANA"),
    "202303070TBL": ("TBL", "PHI"),
    "202303080DET": ("DET", "CHI"),
    "202303080VAN": ("VAN", "ANA"),
    "202303080WPG": ("WPG", "MIN"),
    "202303090ARI": ("ARI", "NSH"),
    "202303090BOS": ("BOS", "EDM"),
    "202303090BUF": ("BUF", "DAL"),
    "202303090CAR": ("CAR", "PHI"),
    "202303090COL": ("COL", "LAK"),
    "202303090MTL": ("MTL", "NYR"),
    "202303090PIT": ("PIT", "NYI"),
    "202303090SEA": ("SEA", "OTT"),
    "202303090STL": ("STL", "SJS"),
    "202303090TBL": ("TBL", "VEG"),
    "202303090WSH": ("WSH", "NJD"),
    "202303100CGY": ("CGY", "ANA"),
    "202303100FLA": ("FLA", "CHI"),
    "202303110BOS": ("BOS", "DET"),
    "202303110BUF": ("BUF", "NYR"),
    "202303110CAR": ("CAR", "VEG"),
    "202303110CBJ": ("CBJ", "STL"),
    "202303110COL": ("COL", "ARI"),
    "202303110FLA": ("FLA", "WPG"),
    "202303110LAK": ("LAK", "NSH"),
    "202303110MTL": ("MTL", "NJD"),
    "202303110NYI": ("NYI", "WSH"),
    "202303110PIT": ("PIT", "PHI"),
    "202303110SEA": ("SEA", "DAL"),
    "202303110SJS": ("SJS", "MIN"),
    "202303110TBL": ("TBL", "CHI"),
    "202303110TOR": ("TOR", "EDM"),
    "202303110VAN": ("VAN", "OTT"),
    "202303120ANA": ("ANA", "NSH"),
    "202303120ARI": ("ARI", "MIN"),
    "202303120CGY": ("CGY", "OTT"),
    "202303120DET": ("DET", "BOS"),
    "202303120NJD": ("NJD", "CAR"),
    "202303120PIT": ("PIT", "NYR"),
    "202303120STL": ("STL", "VEG"),
    "202303120TBL": ("TBL", "WPG"),
    "202303130MTL": ("MTL", "COL"),
    "202303130SEA": ("SEA", "DAL"),
    "202303130TOR": ("TOR", "BUF"),
    "202303140ARI": ("ARI", "CGY"),
    "202303140CAR": ("CAR", "WPG"),
    "202303140CHI": ("CHI", "BOS"),
    "202303140EDM": ("EDM", "OTT"),
    "202303140LAK": ("LAK", "NYI"),
    "202303140NJD": ("NJD", "TBL"),
    "202303140NSH": ("NSH", "DET"),
    "202303140NYR": ("NYR", "WSH"),
    "202303140PHI": ("PHI", "VEG"),
    "202303140PIT": ("PIT", "MTL"),
    "202303140SJS": ("SJS", "CBJ"),
    "202303140VAN": ("VAN", "DAL"),
    "202303150ANA": ("ANA", "NYI"),
    "202303150STL": ("STL", "MIN"),
    "202303150TOR": ("TOR", "COL"),
    "202303150WSH": ("WSH", "BUF"),
    "202303160ARI": ("ARI", "VAN"),
    "202303160EDM": ("EDM", "DAL"),
    "202303160FLA": ("FLA", "MTL"),
    "202303160LAK": ("LAK", "CBJ"),
    "202303160NJD": ("NJD", "TBL"),
    "202303160NSH": ("NSH", "CHI"),
    "202303160NYR": ("NYR", "PIT"),
    "202303160OTT": ("OTT", "COL"),
    "202303160SJS": ("SJS", "SEA"),
    "202303160VEG": ("VEG", "CGY"),
    "202303160WPG": ("WPG", "BOS"),
    "202303170ANA": ("ANA", "CBJ"),
    "202303170PHI": ("PHI", "BUF"),
    "202303170TOR": ("TOR", "CAR"),
    "202303170WSH": ("WSH", "STL"),
    "202303180ARI": ("ARI", "CHI"),
    "202303180CGY": ("CGY", "DAL"),
    "202303180DET": ("DET", "COL"),
    "202303180FLA": ("FLA", "NJD"),
    "202303180LAK": ("LAK", "VAN"),
    "202303180MIN": ("MIN", "BOS"),
    "202303180NSH": ("NSH", "WPG"),
    "202303180NYR": ("NYR", "PIT"),
    "202303180OTT": ("OTT", "TOR"),
    "202303180PHI": ("PHI", "CAR"),
    "202303180SEA": ("SEA", "EDM"),
    "202303180SJS": ("SJS", "NYI"),
    "202303180TBL": ("TBL", "MTL"),
    "202303190ANA": ("ANA", "VAN"),
    "202303190BUF": ("BUF", "BOS"),
    "202303190MIN": ("MIN", "WSH"),
    "202303190NYR": ("NYR", "NSH"),
    "202303190STL": ("STL", "WPG"),
    "202303190TBL": ("TBL", "NJD"),
    "202303190VEG": ("VEG", "CBJ"),
    "202303200COL": ("COL", "CHI"),
    "202303200DET": ("DET", "FLA"),
    "202303200EDM": ("EDM", "SJS"),
    "202303200LAK": ("LAK", "CGY"),
    "202303200PIT": ("PIT", "OTT"),
    "202303210ANA": ("ANA", "CGY"),
    "202303210BOS": ("BOS", "OTT"),
    "202303210BUF": ("BUF", "NSH"),
    "202303210DAL": ("DAL", "SEA"),
    "202303210MTL": ("MTL", "TBL"),
    "202303210NJD": ("NJD", "MIN"),
    "202303210NYI": ("NYI", "TOR"),
    "202303210NYR": ("NYR", "CAR"),
    "202303210PHI": ("PHI", "FLA"),
    "202303210STL": ("STL", "DET"),
    "202303210VAN": ("VAN", "VEG"),
    "202303210WPG": ("WPG", "ARI"),
    "202303210WSH": ("WSH", "CBJ"),
    "202303220COL": ("COL", "PIT"),
    "202303220EDM": ("EDM", "ARI"),
    "202303230ANA": ("ANA", "WPG"),
    "202303230BOS": ("BOS", "MTL"),
    "202303230CAR": ("CAR", "NYR"),
    "202303230CGY": ("CGY", "VEG"),
    "202303230DAL": ("DAL", "PIT"),
    "202303230DET": ("DET", "STL"),
    "202303230FLA": ("FLA", "TOR"),
    "202303230NSH": ("NSH", "SEA"),
    "202303230OTT": ("OTT", "TBL"),
    "202303230PHI": ("PHI", "MIN"),
    "202303230VAN": ("VAN", "SJS"),
    "202303230WSH": ("WSH", "CHI"),
    "202303240BUF": ("BUF", "NJD"),
    "202303240CBJ": ("CBJ", "NYI"),
    "202303240COL": ("COL", "ARI"),
    "202303250ANA": ("ANA", "STL"),
    "202303250BOS": ("BOS", "TBL"),
    "202303250CAR": ("CAR", "TOR"),
    "202303250CGY": ("CGY", "SJS"),
    "202303250DAL": ("DAL", "VAN"),
    "202303250EDM": ("EDM", "VEG"),
    "202303250FLA": ("FLA", "NYR"),
    "202303250LAK": ("LAK", "WPG"),
    "202303250MIN": ("MIN", "CHI"),
    "202303250MTL": ("MTL", "CBJ"),
    "202303250NJD": ("NJD", "OTT"),
    "202303250NSH": ("NSH", "SEA"),
    "202303250NYI": ("NYI", "BUF"),
    "202303250PHI": ("PHI", "DET"),
    "202303250PIT": ("PIT", "WSH"),
    "202303260ARI": ("ARI", "COL"),
    "202303260CAR": ("CAR", "BOS"),
    "202303260CHI": ("CHI", "VAN"),
    "202303260LAK": ("LAK", "STL"),
    "202303260NSH": ("NSH", "TOR"),
    "202303270ANA": ("ANA", "COL"),
    "202303270ARI": ("ARI", "EDM"),
    "202303270BUF": ("BUF", "MTL"),
    "202303270MIN": ("MIN", "SEA"),
    "202303270NYI": ("NYI", "NJD"),
    "202303270OTT": ("OTT", "FLA"),
    "202303280BOS": ("BOS", "NSH"),
    "202303280CAR": ("CAR", "TBL"),
    "202303280CGY": ("CGY", "LAK"),
    "202303280CHI": ("CHI", "DAL"),
    "202303280DET": ("DET", "PIT"),
    "202303280NYR": ("NYR", "CBJ"),
    "202303280PHI": ("PHI", "MTL"),
    "202303280SJS": ("SJS", "WPG"),
    "202303280STL": ("STL", "VAN"),
    "202303280VEG": ("VEG", "EDM"),
    "202303290COL": ("COL", "MIN"),
    "202303290TOR": ("TOR", "FLA"),
    "202303290WSH": ("WSH", "NYI"),
    "202303300BOS": ("BOS", "CBJ"),
    "202303300CHI": ("CHI", "STL"),
    "202303300DET": ("DET", "CAR"),
    "202303300EDM": ("EDM", "LAK"),
    "202303300MTL": ("MTL", "FLA"),
    "202303300NJD": ("NJD", "NYR"),
    "202303300OTT": ("OTT", "PHI"),
    "202303300PIT": ("PIT", "NSH"),
    "202303300SEA": ("SEA", "ANA"),
    "202303300SJS": ("SJS", "VEG"),
    "202303300TBL": ("TBL", "WSH"),
    "202303310ARI": ("ARI", "DAL"),
    "202303310BUF": ("BUF", "NYR"),
    "202303310VAN": ("VAN", "CGY"),
    "202303310WPG": ("WPG", "DET"),
    "202304010ARI": ("ARI", "SJS"),
    "202304010CBJ": ("CBJ", "FLA"),
    "202304010CHI": ("CHI", "NJD"),
    "202304010COL": ("COL", "DAL"),
    "202304010EDM": ("EDM", "ANA"),
    "202304010MTL": ("MTL", "CAR"),
    "202304010NSH": ("NSH", "STL"),
    "202304010OTT": ("OTT", "TOR"),
    "202304010PHI": ("PHI", "BUF"),
    "202304010PIT": ("PIT", "BOS"),
    "202304010SEA": ("SEA", "LAK"),
    "202304010TBL": ("TBL", "NYI"),
    "202304010VEG": ("VEG", "MIN"),
    "202304020CAR": ("CAR", "NYI"),
    "202304020CBJ": ("CBJ", "OTT"),
    "202304020CGY": ("CGY", "ANA"),
    "202304020PIT": ("PIT", "PHI"),
    "202304020STL": ("STL", "BOS"),
    "202304020TOR": ("TOR", "DET"),
    "202304020VAN": ("VAN", "LAK"),
    "202304020WPG": ("WPG", "NJD"),
    "202304020WSH": ("WSH", "NYR"),
    "202304030DAL": ("DAL", "NSH"),
    "202304030MIN": ("MIN", "VEG"),
    "202304030SEA": ("SEA", "ARI"),
    "202304040CAR": ("CAR", "OTT"),
    "202304040CGY": ("CGY", "CHI"),
    "202304040FLA": ("FLA", "BUF"),
    "202304040LAK": ("LAK", "EDM"),
    "202304040MTL": ("MTL", "DET"),
    "202304040NJD": ("NJD", "PIT"),
    "202304040NSH": ("NSH", "VEG"),
    "202304040SJS": ("SJS", "COL"),
    "202304040STL": ("STL", "PHI"),
    "202304040TOR": ("TOR", "CBJ"),
    "202304040VAN": ("VAN", "SEA"),
    "202304050ANA": ("ANA", "EDM"),
    "202304050NYR": ("NYR", "TBL"),
    "202304050WPG": ("WPG", "CGY"),
    "202304060BOS": ("BOS", "TOR"),
    "202304060DAL": ("DAL", "PHI"),
    "202304060DET": ("DET", "BUF"),
    "202304060FLA": ("FLA", "OTT"),
    "202304060MTL": ("MTL", "WSH"),
    "202304060NJD": ("NJD", "CBJ"),
    "202304060NSH": ("NSH", "CAR"),
    "202304060NYI": ("NYI", "TBL"),
    "202304060PIT": ("PIT", "MIN"),
    "202304060SEA": ("SEA", "ARI"),
    "202304060SJS": ("SJS", "COL"),
    "202304060STL": ("STL", "NYR"),
    "202304060VAN": ("VAN", "CHI"),
    "202304060VEG": ("VEG", "LAK"),
    "202304080ARI": ("ARI", "ANA"),
    "202304080BOS": ("BOS", "NJD"),
    "202304080BUF": ("BUF", "CAR"),
    "202304080CBJ": ("CBJ", "NYR"),
    "202304080DAL": ("DAL", "VEG"),
    "202304080DET": ("DET", "PIT"),
    "202304080LAK": ("LAK", "COL"),
    "202304080MIN": ("MIN", "STL"),
    "202304080NYI": ("NYI", "PHI"),
    "202304080OTT": ("OTT", "TBL"),
    "202304080SEA": ("SEA", "CHI"),
    "202304080SJS": ("SJS", "EDM"),
    "202304080TOR": ("TOR", "MTL"),
    "202304080VAN": ("VAN", "CGY"),
    "202304080WPG": ("WPG", "NSH"),
    "202304080WSH": ("WSH", "FLA"),
    "202304090ANA": ("ANA", "COL"),
    "202304090PHI": ("PHI", "BOS"),
    "202304100ARI": ("ARI", "SEA"),
    "202304100CGY": ("CGY", "NSH"),
    "202304100CHI": ("CHI", "MIN"),
    "202304100DET": ("DET", "DAL"),
    "202304100FLA": ("FLA", "TOR"),
    "202304100LAK": ("LAK", "VAN"),
    "202304100NYR": ("NYR", "BUF"),
    "202304100OTT": ("OTT", "CAR"),
    "202304100WPG": ("WPG", "SJS"),
    "202304100WSH": ("WSH", "NYI"),
    "202304110ANA": ("ANA", "VAN"),
    "202304110BOS": ("BOS", "WSH"),
    "202304110CAR": ("CAR", "DET"),
    "202304110COL": ("COL", "EDM"),
    "202304110MIN": ("MIN", "WPG"),
    "202304110NJD": ("NJD", "BUF"),
    "202304110PHI": ("PHI", "CBJ"),
    "202304110PIT": ("PIT", "CHI"),
    "202304110TBL": ("TBL", "TOR"),
    "202304110VEG": ("VEG", "SEA"),
    "202304120CGY": ("CGY", "SJS"),
    "202304120NYI": ("NYI", "MTL"),
    "202304120STL": ("STL", "DAL"),
    "202304130ANA": ("ANA", "LAK"),
    "202304130ARI": ("ARI", "VAN"),
    "202304130BUF": ("BUF", "OTT"),
    "202304130CBJ": ("CBJ", "PIT"),
    "202304130CHI": ("CHI", "PHI"),
    "202304130COL": ("COL", "WPG"),
    "202304130DAL": ("DAL", "STL"),
    "202304130EDM": ("EDM", "SJS"),
    "202304130FLA": ("FLA", "CAR"),
    "202304130MTL": ("MTL", "BOS"),
    "202304130NSH": ("NSH", "MIN"),
    "202304130NYR": ("NYR", "TOR"),
    "202304130SEA": ("SEA", "VEG"),
    "202304130TBL": ("TBL", "DET"),
    "202304130WSH": ("WSH", "NJD"),
    "202304140CBJ": ("CBJ", "BUF"),
    "202304140NSH": ("NSH", "COL")
}

# File paths for the CSV outputs
base_path = r"C:\Users\ashle\Documents\Projects\hockey"
file_paths = {
    "skaters": os.path.join(base_path, "hockeyRefBoxscores_Skaters2022.csv"),
    "adv_skaters": os.path.join(base_path, "hockeyRefBoxscores_AdvSkaters2022.csv")
}

skaters_columns = [
    "Rk", "Season", "Game", "GameID", "Date", "Home", "HomeName", "Away", "AwayName", "Player", "PlayerID", "Team", "TeamName", "Is_Home", "Opp", "OppName", "G", "A", "PTS", "SOG", "TOI", "PIM", "EVG", "PPG", "SHG", "EVA", "PPA", "SHA"
]

# Initialize lists to collect data
skaters_data = []
adv_skaters_data = []

for game_id, (home_team, away_team) in games_info.items():
    url = f"https://www.hockey-reference.com/boxscores/{game_id}.html"

    try:
        print(f"Processing game ID {game_id} - Home Team: {home_team}, Away Team: {away_team}")
        html_content = fetch_webpage(url)
        soup = BeautifulSoup(html_content, 'html.parser')
        
        # Get full team names
        home_team_section = soup.select_one(f"#{home_team}_skaters_sh")
        away_team_section = soup.select_one(f"#{away_team}_skaters_sh")
        home_team_name = home_team_section.find("h2").get_text(strip=True) if home_team_section else "Unknown"
        away_team_name = away_team_section.find("h2").get_text(strip=True) if away_team_section else "Unknown"

        # Extract skaters table
        for team, team_name, is_home in [
            (home_team, home_team_name, True),
            (away_team, away_team_name, False),
        ]:
            table_selector = f"#{team}_skaters"
            table = soup.select_one(table_selector)
            if table:
                # Extract the correct header row (second row in the <thead>)
                header_row = table.select("thead tr")[1]
                headers = [th.get_text(strip=True) for th in header_row.find_all("th")]

                # Read the table and set the headers
                df = pd.read_html(StringIO(str(table)), encoding="utf-8")[0]
                df.columns = headers
                
                # Fix encoding issues in player names
                df["Player"] = df["Player"].str.encode('latin1').str.decode('utf-8', errors='ignore')

                # Keep only rows within tbody (skip footer by limiting rows if needed)
                df = df.iloc[:table.select("tbody tr").__len__()]
                
                column_mapping = {
                    "S": "SOG", 
                    "EV": ["EVG", "EVA"],  # Two EV columns
                    "PP": ["PPG", "PPA"],  # Two PP columns
                    "SH": ["SHG", "SHA"],  # Two SH columns
                }
                
                column_names = list(df.columns)
                for i, col in enumerate(column_names):
                    if col == "EV":
                        column_names[i] = column_mapping["EV"].pop(0)
                    elif col == "PP":
                        column_names[i] = column_mapping["PP"].pop(0)
                    elif col == "SH":
                        column_names[i] = column_mapping["SH"].pop(0)
                    elif col == "S":
                        column_names[i] = column_mapping["S"]
                df.columns = column_names
                
                df = df[["Rk", "Player", "G", "A", "PTS", "SOG", "TOI", "PIM", "EVG", "PPG", "SHG", "EVA", "PPA", "SHA"]]
                
                if "TOI" in df.columns:
                    df["TOI"] = df["TOI"].apply(convert_toi_to_decimal)

                # Insert metadata columns              
                df.insert(0, "Season", "2024-25")
                df.insert(1, "Game", f"{home_team} vs {away_team}")
                df.insert(2, "GameID", game_id)
                df.insert(3, "Date", extract_date_from_game_id(game_id))     
                df.insert(4, "Home", home_team)
                df.insert(5, "HomeName", home_team_name)
                df.insert(6, "Away", away_team)
                df.insert(7, "AwayName", away_team_name)
                
                # Extract Player IDs from 'data-append-csv' attribute in <td> tags
                player_ids = [cell.get("data-append-csv") for cell in table.select("tbody tr td[data-append-csv]")]
                df.insert(df.columns.get_loc("Player") + 1, "PlayerID", player_ids + [None] * (len(df) - len(player_ids)))
                df.insert(df.columns.get_loc("Player") + 2, "Team", home_team if is_home else away_team)
                df.insert(df.columns.get_loc("Player") + 3, "TeamName", home_team_name if is_home else away_team_name)
                df.insert(df.columns.get_loc("Player") + 4, "Is_Home", 1 if is_home else 0)
                df.insert(df.columns.get_loc("Player") + 5, "Opp", away_team if is_home else home_team)
                df.insert(df.columns.get_loc("Player") + 6, "OppName", away_team_name if is_home else home_team_name)
                
                df = df.reindex(columns=skaters_columns, fill_value=None)

                skaters_data.append(df)

        # Extract advanced skaters table
        for team in [away_team, home_team]:
            table_selector = f"#{team}_adv_ALLAll"
            table = soup.select_one(table_selector)
            if table:
                # Read the table and set the headers
                df = pd.read_html(StringIO(str(table)), encoding="utf-8")[0]
                
                # Keep only rows within tbody
                df = df.iloc[:table.select("tbody tr").__len__()]

                # Insert metadata columns
                df.insert(0, "GameID", game_id)

                # Extract Player IDs from 'data-append-csv' attribute in <td> tags
                player_ids = [cell.get("data-append-csv") for cell in table.select("tbody tr th[data-append-csv]")]
                df["PlayerID"] = player_ids + [None] * (len(df) - len(player_ids))  # Handle rows without Player IDs

                adv_skaters_data.append(df)

        # Wait to avoid rate limiting
        time.sleep(3)
        
    except requests.RequestException as e:
        print(f"Error fetching data for game ID {game_id}: {e}")
    except Exception as e:
        print(f"Error processing data for game ID {game_id}: {e}")


# Merge skaters_data and adv_skaters_data
if skaters_data and adv_skaters_data:
    skaters_df = pd.concat(skaters_data, ignore_index=True)
    adv_skaters_df = pd.concat(adv_skaters_data, ignore_index=True)

    # Merge on PlayerID and GameID
    merged_df = skaters_df.merge(
        adv_skaters_df[["GameID", "PlayerID", "HIT", "BLK", "SAT‑F"]],
        on=["GameID", "PlayerID"],
        how="left"
    )

    # Reorder columns according to the specified schema
    merged_columns = [
        "Rk", "Season", "Game", "GameID", "Date", "Home", "HomeName", "Away", "AwayName", "Player", "PlayerID", "Team", "TeamName", "Is_Home", "Opp", "OppName", "G", "A", "PTS", "SOG", "HIT", "BLK", "TOI", "PIM", "EVG", "PPG", "SHG", "EVA", "PPA", "SHA", "SAT‑F"
    ]
    merged_df = merged_df.reindex(columns=merged_columns)

    # Save the merged DataFrame to a single CSV file
    merged_file_path = os.path.join(base_path, "hockeyRefBoxscores_Merged2022.csv")
    merged_df.to_csv(merged_file_path, index=False, encoding="utf-8")
    print(f"Merged data successfully saved to {merged_file_path}")
else:
    print("Insufficient data to merge. Ensure both skaters and advanced skaters tables are populated.")
